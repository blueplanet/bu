%h1
  - group = @event.group
  = link_to group.name, group
  = @event.title

%p#notice= notice

- if @event.image_url?
  .logo
    %img.logo{ :src => @event.image_src }

%table
  %tr
    %td== #{_ 'event owner'} :
    %td= link_to @event.owner.name, @event.owner

  %tr
    %td== #{_ :date} :
    %td
      - s = @event.started_at
      - e = @event.ended_at
      = date_time(s)
      - if e > s
        == ...
        - if s.year == e.year and s.mon == e.mon and s.day == e.day
          = hour_min(e)
        - else
          = date_time(e)
  - if @event.limit?
    %tr
      %td== #{_ :Limit}:
      %td= @event.limit
  - if @event.place?
    %tr
      %td== #{_ :Place}:
      %td= @event.place
  - if @event.address?
    %tr
      %td== #{_ :Address}:
      %td= @event.address

- if @event.description?
  %hr
  .description
    != simple_html_compiler(@event.description)

%hr
.state
  - if @event.ended?
    %p=_ 'This event has ended.'
  %b=_ 'Your state'
  \:
  - if @user.nil?
    =_ :unknown
    - if group.public?
      %span.update.atnd
        %span.attend= link_to _(:attend), event_path(@event) + '/attend'
    - else
      = link_to 'Please login...', '/users/new'
  - elsif atnd = @user.atnd(@event)
    %span.atnd== #{_ atnd.state.capitalize}
    %span.update= link_to _(:cancel), event_path(@event) + '/delete'
  - elsif group.member?(@user)
    =_ :unknown
    %span.update.atnd
      %span.attend= link_to _(:attend), event_path(@event) + '/attend'
      %span.absent= link_to _(:absent), event_path(@event) + '/absent'
      %span.maybe=  link_to _(:maybe), event_path(@event) + '/maybe'
  - else
    =_ :unknown
    - if group.public?
      %span.update.atnd
        %span.attend= link_to _(:attend), event_path(@event) + '/attend'
    - else
      You are not a member of
      = link_to group.name, group

%hr

.users.attendees
  %b.group_name=_ :Attendees
  \:
  - @event.attendees.each do |user|
    = link_to user.name, user
  - if @event.waiting_attendees.count > 0
    \/
    %b.red=_ :WaitingAttendees
    \:
    %span.gray.waiting_attendees
      - @event.waiting_attendees.each do |user|
        = link_to user.name, user
.users.absentees
  %b.group_name=_ :Absentees
  \:
  - @event.absentees.each do |user|
    = link_to user.name, user
  - if @event.maybees.count > 0
    \/
    %b=_ :Maybe
    \:
    %span.maybees
      - @event.maybees.each do |user|
        = link_to user.name, user

%h2=_ 'Comments and Logs'
- if @user and group.member?(@user)
  = render 'comments/form'

- @event.comments.order('created_at desc').each do |comment|
  .comment
    %b= comment.user.name
    = comment.text
    %span.small= link_to date_time(comment.created_at), comment

.bottom_menu
  = link_to group.name, group
  - if @user and @event.manager?(@user)
    = link_to _('Edit'), edit_event_path(@event)
    = link_to 'Destroy', @event, :confirm => 'Are you sure?', :method => :delete
